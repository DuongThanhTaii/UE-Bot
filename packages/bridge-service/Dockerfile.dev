FROM node:22-alpine

RUN corepack enable && corepack prepare pnpm@latest --activate

WORKDIR /app

# Copy workspace config
COPY package.json pnpm-lock.yaml pnpm-workspace.yaml ./
COPY packages/bridge-service/package.json ./packages/bridge-service/
COPY packages/shared/package.json ./packages/shared/

# Install all dependencies
RUN pnpm install

# Copy source (will be overridden by volume mount)
COPY . .

EXPOSE 8080

CMD ["pnpm", "--filter", "@ue-bot/bridge-service", "dev"]
